<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shifat Shahriar Siam | Public Health & Informatics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; scroll-behavior: smooth; }
        h1, h2, h3 { font-family: 'Lora', serif; }
        .gradient-text { background: -webkit-linear-gradient(45deg, #10B981, #2563eb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); }
        #payment-modal { display: none; }
        #payment-modal.flex { display: flex; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">
    <main class="container mx-auto px-6 py-12">
        <section id="notes" class="mb-24">
            <h2 class="text-4xl font-bold text-center mb-12">Premium Class Notes</h2>
            <div id="notes-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p id="loading-notes-message" class="col-span-full text-center text-slate-500">Loading notes...</p>
            </div>
        </section>

        </main>
    <footer class="bg-slate-900 text-slate-400"></footer>

    <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-60 items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative m-4">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800">&times;</button>
            <h3 id="modal-note-title" class="text-2xl font-bold mb-2"></h3>
            <p id="modal-note-price" class="text-xl font-semibold text-emerald-600 mb-4"></p>
            <p class="text-slate-600 mb-6">To get access, please choose one of the options below:</p>
            
            <div class="space-y-4">
                <div class="border rounded-lg p-4">
                    <h4 class="font-bold">Option 1: Pay with bKash</h4>
                    <p class="text-sm text-slate-500 mt-1">Send the amount to the bKash number below, then submit your email and the Transaction ID (TrxID).</p>
                    <p class="my-3 text-center bg-slate-100 p-2 rounded">bKash Send Money: <strong class="text-red-600">01xxxxxxxxx</strong></p>
                    <form id="bkash-form" class="space-y-3">
                        <input id="user-email" type="email" class="w-full p-2 border rounded" placeholder="Your Email Address" required>
                        <input id="trx-id" type="text" class="w-full p-2 border rounded" placeholder="bKash Transaction ID (TrxID)" required>
                        <button type="submit" class="w-full bg-emerald-600 text-white font-bold py-2 px-4 rounded hover:bg-emerald-700">Submit for Verification</button>
                    </form>
                </div>

                <div class="border rounded-lg p-4">
                    <h4 class="font-bold">Option 2: Watch an Ad</h4>
                    <p class="text-sm text-slate-500 mt-1">Watch a short ad to get temporary access to this note.</p>
                    <button id="watch-ad-btn" class="mt-3 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">Watch Ad for Access</button>
                    <p class="text-xs text-center mt-2 text-slate-400">Full Google AdSense integration would be required for this feature to work.</p>
                </div>
            </div>
             <p id="modal-success-message" class="text-center mt-4 text-green-600 font-bold"></p>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = { /* Your Config */ };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // --- DYNAMIC NOTES LOADER ---
      const notesContainer = document.getElementById('notes-container');
      db.collection('notes').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
          notesContainer.innerHTML = '';
          if (snapshot.empty) { notesContainer.innerHTML = '<p class="col-span-full text-center">No notes available for sale yet.</p>'; return; }
          snapshot.forEach(doc => {
              const note = doc.data();
              const noteCard = document.createElement('div');
              noteCard.className = 'card-hover bg-gradient-to-br from-emerald-50 to-teal-100 rounded-xl shadow-lg overflow-hidden text-center p-8 flex flex-col';
              noteCard.innerHTML = `
                  <div class="text-emerald-500 text-5xl mb-4"><i class="fas fa-file-alt"></i></div>
                  <h3 class="text-2xl font-bold text-slate-800 mb-2">${note.title}</h3>
                  <p class="text-slate-600 flex-grow mb-6">${note.description}</p>
                  <div class="text-4xl font-extrabold text-slate-900 mb-6">৳${note.price}</div>
                  <button data-note-id="${doc.id}" data-note-title="${note.title}" data-note-price="৳${note.price}" class="get-access-btn bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg w-full hover:bg-emerald-600 transition">Get Access</button>
              `;
              notesContainer.appendChild(noteCard);
          });
      });

      // --- PAYMENT MODAL LOGIC ---
      const paymentModal = document.getElementById('payment-modal');
      const closeModalBtn = document.getElementById('close-modal-btn');
      const bKashForm = document.getElementById('bkash-form');
      let currentNoteId = null;

      notesContainer.addEventListener('click', e => {
          if (e.target.classList.contains('get-access-btn')) {
              currentNoteId = e.target.dataset.noteId;
              document.getElementById('modal-note-title').textContent = e.target.dataset.noteTitle;
              document.getElementById('modal-note-price').textContent = e.target.dataset.notePrice;
              document.getElementById('modal-success-message').textContent = '';
              bKashForm.reset();
              paymentModal.classList.add('flex');
          }
      });

      closeModalBtn.addEventListener('click', () => paymentModal.classList.remove('flex'));

      bKashForm.addEventListener('submit', async e => {
          e.preventDefault();
          const userEmail = document.getElementById('user-email').value;
          const trxId = document.getElementById('trx-id').value;
          try {
              await db.collection('transactions').add({
                  noteId: currentNoteId,
                  userEmail: userEmail,
                  trxId: trxId,
                  status: 'pending', // You will change this to 'approved' in the admin panel
                  submittedAt: firebase.firestore.FieldValue.serverTimestamp()
              });
              document.getElementById('modal-success-message').textContent = 'Submission successful! You will be notified via email once access is approved.';
              bKashForm.reset();
          } catch (error) {
              console.error("Error submitting transaction: ", error);
              document.getElementById('modal-success-message').textContent = 'Something went wrong. Please try again.';
          }
      });
      
      document.getElementById('watch-ad-btn').addEventListener('click', () => {
          alert("In a real app, a rewarded video ad from Google AdSense would play here. After completion, access would be granted.");
      });

      // Other scripts for blog, newsletter etc remain the same.
    </script>
</body>
</html>
